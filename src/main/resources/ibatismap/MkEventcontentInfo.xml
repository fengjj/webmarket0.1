<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap 
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">


<sqlMap namespace="MkEventcontentInfo">


	<sql id="select-all-column">
	SELECT
		event_id AS eventId,
		actconduct_par_id AS actconductParId,
		actconduct_id AS actconductId,
		actconduct_par_value AS actconductParValue,
		batch_no AS batchNo	
	FROM mk_eventcontent_info
	</sql>
	
	<sql id="where-all-condition">
	<dynamic prepend=" WHERE ">
		<isPropertyAvailable property="eventId" prepend="and">
			<isNotNull property="eventId">
				<isNotEmpty property="eventId">
					event_id = #eventId#
				</isNotEmpty>
			</isNotNull>
		</isPropertyAvailable>
		<isPropertyAvailable property="actconductParId" prepend="and">
			<isNotNull property="actconductParId">
				<isNotEmpty property="actconductParId">
					actconduct_par_id = #actconductParId#
				</isNotEmpty>
			</isNotNull>
		</isPropertyAvailable>
		<isPropertyAvailable property="actconductId" prepend="and">
			<isNotNull property="actconductId">
				<isNotEmpty property="actconductId">
					actconduct_id = #actconductId#
				</isNotEmpty>
			</isNotNull>
		</isPropertyAvailable>
		<isPropertyAvailable property="actconductParValue" prepend="and">
			<isNotNull property="actconductParValue">
				<isNotEmpty property="actconductParValue">
					actconduct_par_value = #actconductParValue#
				</isNotEmpty>
			</isNotNull>
		</isPropertyAvailable>
		<isPropertyAvailable property="batchNo" prepend="and">
			<isNotNull property="batchNo">
				<isNotEmpty property="batchNo">
					batch_no = #batchNo#
				</isNotEmpty>
			</isNotNull>
		</isPropertyAvailable>
	</dynamic>
	</sql>
	<!-- 查询事件下的配置的所有元素 -->
	<select id="selectConductsById" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	select c.actconduct_id AS actconductId,
	ac.actconduct_name AS actconductName,
	ac.actconduct_type AS actconductType
	from mk_eventcontent_info c 
	LEFT JOIN mk_actconduct_dict ac 
	on c.actconduct_id = ac.actconduct_id
	where c.event_id = #eventId#
	group by c.actconduct_id;
	</select>
	
	<select id="selectMkEventcontentInfoById" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		<include refid="select-all-column"/>
		WHERE event_id = #eventId#
	</select>

	<select id="selectMkEventcontentInfo" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		<include refid="select-all-column"/>
		<include refid="where-all-condition"/>
	</select>
	
	<insert id="insertMkEventcontentInfo" parameterClass="java.util.Map">
	INSERT INTO mk_eventcontent_info (
		event_id,
		actconduct_par_id,
		actconduct_id,
		actconduct_par_value,
		batch_no
	) VALUES (
		#eventId# ,
		#actconductParId# ,
		#actconductId# ,
		#actconductParValue# ,
		#batchNo#     
	)
	</insert>
	
	<delete id="deleteMkEventcontentInfoById" parameterClass="java.util.Map">
	DELETE FROM mk_eventcontent_info
	WHERE event_id = #eventId#
	</delete>
<select id="selectImgContentListActid" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
		t.actconduct_id AS actconductId,
		t.actconduct_par_id AS actconductParId,
		b.parameter_name AS parameterName,
		t.actconduct_par_value AS actconductParValue,
		a.event_name AS eventName,
		a.priority_code AS priorityCode,
		a.max_order_num AS maxOrderNum,
		date_format(a.start_date,'%Y-%m-%d') AS startDate,
		date_format(a.end_date,'%Y-%m-%d') AS endDate,
		a.event_type AS busiType,
		(select field_desc from mk_codename_dict  where table_en_name = 'mk_eventtype_dict' AND field_value = a.event_type) AS busiName,
		a.event_desc AS eventDesc
		from mk_eventcontent_info t,
		mk_actconductpar_dict b,
		mk_event_info a
		where 
		t.actconduct_par_id = b.parameter_id 
		and t.event_id = a.event_id 
		and  t.event_id=#actId# 
		order by t.actconduct_id, t.batch_no
	</select>
</sqlMap>
